# ⚡️웹 브라우저란?

**서버에서 받아온 HTML CSS JS를 실행시켜주는 프로그램이다.**
근데 브라우저가 자바스크립트를 실행하는데 일련의 과정이 있다.<br>
<br>
브라우저는 C++이라는 언어로 코드가 짜여져 있다.<br>
브라우저는 실행해야할 자바스크립트 코드를 발견하면<br>
C++ 언어로 만들어둔 stack에 넣어 돌린다.<br>

### 처리가 오래걸리는 코드를 만나면

가끔가다가 특별한 코드를 실행해야할 경우가 있다.<br>
서버로의 ajax 요청, 이벤트리스너, setTimeout 이런 코드들이다.<br>
이런 코드는 처리하기까지 시간이 오래걸린다.<br>
ajax 요청은 서버에서 응답을 받기까지 시간이 오래걸리고<br>
버튼 이벤트리스너는 사용자가 버튼을 누르기까지 시간이 오래걸린다.<br>
그래서 그런건 Stack에 쌓아서 실행하지 않고 잠깐 보류해놨다가 완료되는 시점에 Stack으로 보낸다.<br>
<br>
근데 Stack은 항상 바쁘기 때문에 Stack이 텅 빈 시점에 집어넣게 되어있다.<br>
ajax 요청, 이벤트리스너, setTimeout 이런 코드가 실행준비가 되면<br>
Queue라는 곳에 집어넣고 Queue에 있던 코드는 Stack으로 옮겨서 실행해주는데<br>
Stack에 넣어서 실행하는데 Stack이 비어있을 때만 차례로 집어넣어서 실행해준다.<br>
(참고로 Queue는 들어온 순서대로 차례차례 Stack으로 옮겨준다.)<br>

### 코드짤 때 이렇게 코드를 짜면 안된다.

Stack을 바쁘게 만들면 ajax요청, 이벤트리스터, setTimeout 이런 코드 실행이 불가능한 것이다.<br>
반복문을 1억번 돌리면 시간이 10초걸린다고 가정하고 그럼 10초동안 ajax 요청, 이벤트리스너, <br>setTimeout 이런 코드는 실행이 불가능하다.<br>
Stack이 10초동안 비지 않기 때문에 그렇다.<br>
그럼 브라우저가 멈추거나 하얗게 변하거나 그런 현상이 일어난다.<br>
**결론: Stack을 바쁘게하면 웹사이트가 버벅이겠구나 라는 생각을 하며 코드 작성을 하자.**

### 반복문을 100억번?

```js
for (let i = 0; i < 1e10; i++) {
  i++;
}
```

(참고로 1e10은 0을 10개 붙이라는 뜻이다)<br>
이렇게 쓰면 반복문이 100억번 돌아가는데 아무리 CPU가 좋아도 시간이 걸린다.<br>
10초가 걸린다고 하면 10초동안 사용자가 버튼클릭 이런게 전여 안먹는다는 소리이다.<br>

이런 작업을 꼭해야한다면 가장 간단한 트릭은<br>

#### 1.setTimeout을 이용하기

setTimeout()을 이용해서 0초마다 0~1억 반복, 1억~2억 반복, 2억~3억 반복...<br>
이렇게 코드를 실행하면 보다 쾌적하게 작업을 실행할 수 있다.<br>
0초마다 Queue로 보내기 때문에 그 사이사이에 사용자의 이벤트리스너 이런 코드를 실행가능하다.<br>
(setTimeout 타이머를 0초로 설정해도 실은 4ms로 동작한다 설정가능한 최소시간이 4ms)<br>

#### 2.Web worker를 이용하기

다른 자바스크립트 파일을 이용해서<br>
그 파일에서 힘든 연산을 시키고 그게 완료가 되면 값을 가져오라고 명령이 가능하다.<br>
이미 만들어진 Worker라는 클래스를 사용하면 된다.<br>

```js
(메인 js 파일)
var myWorker = new Worker('worker.js');

w.onmessage = function(e){
  console.log(e.data)
};
```

```js
(worker.js 파일)

var i = 0;
postMessage(i + 1); //postMessage라는 특별한 함수가 있음
```

이런 식으로 셋팅해놓으면<br>
worker.js에서 작업이 완료될 시 postMessage() 이렇게 실행하면<br>
다른 파이롤 완료된 결과값을 전달해줄 수 있다.<br>
이러면 Stack이 바빠지지 않는다.<br>
